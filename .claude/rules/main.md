# AI 工作规则

## 权限
完全权限执行命令并自动修复错误。禁止操作远端仓库。

## 工作模式

### 交互模式(默认)
技术选型、多方案、重要决策时使用 `AskUserQuestion` 询问。

### 无人值守模式
触发词:"进入无人值守模式"
- 直接选择最佳实践，禁用 `AskUserQuestion`，自动修复错误

### 谋定而后动
触发词:"谋定而后动"、"先讨论"
- 先分析讨论规划，确认方案后再执行

## 核心原则
- 辩证客观思考，不盲目执行（除非明确要求）
- 避免过度设计，以项目目标为准
- 禁用高 token 消耗的 MCP（如 chrome）

## 行为规范

### 1. 禁止占位实现
必须真正调用底层实现并产生正确结果。可临时写 TODO 并创建技术债检查单。

### 2. 必须实际测试验证
流程：修改代码 → 运行平台（`npm run dev:*`）→ 查看日志（`npm run logcat:*`）→ 确认生效
**关键**：编译通过 ≠ 运行正常

### 3. DRY 原则（Don't Repeat Yourself）
- 文档：全局规范写一次，不在多处重复定义
- 代码：3+ 次重复考虑提取，5+ 次重复考虑封装
- 判断：辩证思考，避免为复用而复用


## 开发流程

### 启动
`npm run dev:*` 启动开发服务

### 开发
理解需求 → 探索代码 → 实现 → 验证

### 调试
编译器日志（语法错误）→ 运行日志 `npm run logcat:*`（运行时错误）→ 定位修复

### DoD（完成标准）
**核心：实际运行成功才算完成**
1. 代码完成 + 编译通过
2. 实际运行 + 日志确认功能正常
3. 无运行错误
4. 记录经验教训（如有）


## 经验教训记录

### 时机
**达到 DoD 后立即主动检查并记录**（禁止未验证前记录）

### 值得记录的内容
- 非显而易见的技术问题及解决方案
- 容易踩的坑及规避方法
- 性能优化、调试技巧
- 框架/库的特殊用法

记录到 `.claude/rules/lessons-learned.md` 并注明验证方式

## 关键规则
1. 修改代码前必须先读取
2. 完成核心功能后主动运行测试验证
3. 提炼有用内容为经验教训，避免重复错误
4. 代码遵从 DRY 原则

## 对话结尾要求

### 规则文档加载确认
列出已加载的规则文档路径

### Token 统计
- 本次对话消耗
- 主要分布及占比
- 规则文档读取占比