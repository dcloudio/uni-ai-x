<template>
	<text :decode="true" class="text" :class="itemType +  '-box' + (itemType == 'list' ? ' list-content' : '')">
		<text v-for="(data, index) in datas" :key="index"
			:class="data.className ?? ''" 
			@click="toLink(data.href)"
			:decode="true"
		>{{data.text}}</text>
	</text>
</template>

<script setup>
	import { MarkdownToken} from '@/uni_modules/uni-cmark';
	type UniAiTextMdProps = {
		datas: MarkdownToken[]
		itemType: string
	}

	const props = defineProps({
		datas: {
			type: Array as PropType<MarkdownToken[]>,
			required: true
		},
		itemType: {
			type: String,
			required: true
		}
	})
	
	const toLink = (url: string | null) => {
		if (url != null && url!.length > 0) {
			// console.error('url', url)
			uni.navigateTo({
				"url":"/uni_modules/uni-ai-x/pages/common/webview/webview?url="+url,
				fail:e=>{
					console.error(e);
				}
			})
		}
	}
</script>

<style lang="scss">
	// 元素的样式
	@font-face {
		// #ifdef WEB
		font-display: swap;
		// #endif
		font-family: uniAiIconFontFamily;
		src: url('/uni_modules/uni-ai-x/static/font/iconfont.ttf');
	}
	.uni-ai-icon {
		font-family: uniAiIconFontFamily;
	}
	
	.text {
		color: var(--text-primary);
		// line-height: 1.5; // TODO：解决 text 嵌套会重叠文本的问题
		white-space: normal;
		/* #ifndef APP */
		word-break: break-all;
		max-width: 100%;
		/* #endif */
	}
	.strong {
		font-weight: bold;
	}
	
	.em {
		font-style: italic;
	}
	
	.del {
		text-decoration-line: line-through;
		color: var(--text-tertiary);
	}

	.space {
		height: 10px;
	}
	.link {
		color: var(--accent-primary)!important;
		// #ifdef WEB
		cursor: pointer;
		&:hover {
			opacity: 0.8;
		}
		// #endif
	}
	// .image {
	// 	max-width: 60%;
	// }

	.paragraph-box {
		.text {
			font-size: 18px;
			// 自动换行
			white-space: normal;
			/* #ifndef APP */
			max-width: 100%;
			word-break: break-all;
			/* #endif */
		}
	}
	
	.heading-box {
		width: 100%;
		margin: 5px 0;
		.text {
			font-weight: 700;
		}
		.depth-1 {
			font-size: 30px;
			line-height: 36px;
		}

		.depth-2 {
			font-size: 26px;
			line-height: 34px;
		}

		.depth-3 {
			font-size: 22px;
			line-height: 32px;
		}

		.depth-4 {
			font-size: 20px;
			line-height: 30px;
		}

		.depth-5 {
			font-size: 18px;
			line-height: 28px;
		}

		.depth-6 {
			font-size: 16px;
			color: var(--text-tertiary);
			line-height: 24px;
		}
	}

	.hr {
		height: 1px;
		background: var(--border-primary);
		margin: 10px 0;
	}

	.list-box {
		padding-left: 5px;
		.list-content {
			width: 100%;
		}
		.text {
			line-height: 28px;
		}
		.list-item-content-box {
			flex: 1;
			.list {
				margin-top: 0;
			}
		}
		.list-item-br {
			width: 100%;
		}
		.list-item-index {
			width: 20px;
			font-size: 14px;
			color: var(--text-secondary);
			&.unordered {
				color: var(--text-primary);
			}
		}
	}
	
	.linebreak {
		width: 100%;
		height: 0;
	}
	.paragraph-box {
		margin-top: 0;
		margin-bottom: 0;
	}

	.space-box {
		height: 15px;
	}

	.code {
		color: var(--text-secondary);
		background-color: var(--bg-secondary);
		padding: 2px 4px;
		border-radius: 5px;
		font-size: 14px;
	}

	.thematic_break {
		height: 1px;
		background: var(--border-primary);
		margin: 10px 0;
	}
	
	.strikethrough {
		// 删除线
		text-decoration-line: line-through;
		color: var(--text-tertiary);
	}
	.bold_italic {
		/* 加粗且斜体 */
		font-weight: bold;
		font-style: italic;
	}
</style>